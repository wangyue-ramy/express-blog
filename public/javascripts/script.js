function init(){wrap(img).insertBefore(createSpan("resize-handle resize-handle-nw"),img).parentNode.insertBefore(createSpan("resize-handle resize-handle-ne"),img).parentNode.appendChild(createSpan("resize-handle resize-handle-se")).parentNode.appendChild(createSpan("resize-handle resize-handle-sw")),orig_src.src=img.src,container=document.getElementsByClassName("resize-container")[0],container.addEventListener("mousedown",startResize),container.addEventListener("mousedown",startMove),crop_btn.addEventListener("click",confirm)}function startResize(e){e.preventDefault(),e.stopPropagation(),-1!=e.target.className.indexOf("resize-handle")&&(saveEventStage(e),document.addEventListener("mousemove",resizing),document.addEventListener("mouseup",endResize))}function resizing(e){var t,n,i=container.offsetTop,o=container.offsetLeft,a=event_state.event.target.className;-1!=a.indexOf("ne")?(t=e.clientX-event_state.container_left,n=event_state.container_height-(e.clientY-event_state.container_top),i=e.clientY-container.offsetParent.offsetTop):-1!=a.indexOf("nw")?(t=event_state.container_width-(e.clientX-event_state.container_left),n=event_state.container_height-(e.clientY-event_state.container_top),i=e.clientY-container.offsetParent.offsetTop,o=e.clientX-container.offsetParent.offsetLeft):-1!=a.indexOf("se")?(t=e.clientX-event_state.container_left,n=e.clientY-event_state.container_top):-1!=a.indexOf("sw")&&(t=event_state.container_width-(e.clientX-event_state.container_left),n=e.clientY-event_state.container_top,o=e.clientX-container.offsetParent.offsetLeft),resizeImage(t,n),container.style.top=i+"px",container.style.left=o+"px"}function resizeImage(e,t){img.style.width=e+"px",img.style.height=t+"px"}function endResize(e){document.removeEventListener("mousemove",resizing,!1),document.removeEventListener("mouseup",endResize,!1)}function startMove(e){e.preventDefault(),e.stopPropagation(),"img"==e.target.nodeName.toLowerCase()&&(saveEventStage(e),document.addEventListener("mousemove",moving),document.addEventListener("mouseup",endMove))}function moving(e){var t=event_state.container_top+e.clientY-event_state.mouseY-container.offsetParent.offsetTop,n=event_state.container_left+e.clientX-event_state.mouseX-container.offsetParent.offsetLeft;container.style.top=t+"px",container.style.left=n+"px"}function endMove(e){document.removeEventListener("mousemove",moving,!1),document.removeEventListener("mouseup",endMove,!1)}function confirm(e){var t,n=orig_height/img.clientHeight,i=orig_width/img.clientWidth,o=document.getElementById("overlay"),a=(o.offsetLeft-container.offsetLeft)*i,s=(o.offsetTop-container.offsetTop)*n,r=o.clientWidth*i,c=o.clientHeight*n;t=document.createElement("canvas"),t.width=r,t.height=c,t.getContext("2d").drawImage(img,a,s,r,c,0,0,r/i,c/n),window.open(t.toDataURL("image/png"))}function saveEventStage(e){var t=getOffset(container);event_state.container_width=container.offsetWidth,event_state.container_height=container.offsetHeight,event_state.container_left=t.left,event_state.container_top=t.top,event_state.mouseX=e.clientX,event_state.mouseY=e.clientY,event_state.event=e}function wrap(e){var t=document.createElement("div"),n=document.getElementsByClassName("screenshot-wrap")[0];return t.className="resize-container",n.insertBefore(t,e),t.appendChild(e),t}function createSpan(e){var t=document.createElement("span");return t.className=e,t}function getOffset(e){for(var t=e.offsetLeft,n=e.offsetTop,i=e.offsetParent;null!==i;)t+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;return{left:t,top:n}}function getMousePosition(e){console.log(e.clientX,e.clientY)}var orig_src=new Image,event_state={},container,img=document.getElementById("img"),resize_canvas=document.createElement("canvas"),crop_btn=document.getElementById("btn"),orig_height=img.clientHeight,orig_width=img.clientWidth;img.style.maxHeight="450px",document.addEventListener("click",getMousePosition),window.addEventListener("load",init);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJpbml0Iiwid3JhcCIsImltZyIsImluc2VydEJlZm9yZSIsImNyZWF0ZVNwYW4iLCJwYXJlbnROb2RlIiwiYXBwZW5kQ2hpbGQiLCJvcmlnX3NyYyIsInNyYyIsImNvbnRhaW5lciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdGFydFJlc2l6ZSIsInN0YXJ0TW92ZSIsImNyb3BfYnRuIiwiY29uZmlybSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsInRhcmdldCIsImNsYXNzTmFtZSIsImluZGV4T2YiLCJzYXZlRXZlbnRTdGFnZSIsInJlc2l6aW5nIiwiZW5kUmVzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJ0b3AiLCJvZmZzZXRUb3AiLCJsZWZ0Iiwib2Zmc2V0TGVmdCIsImNsc05hbWUiLCJldmVudF9zdGF0ZSIsImV2ZW50IiwiY2xpZW50WCIsImNvbnRhaW5lcl9sZWZ0IiwiY29udGFpbmVyX2hlaWdodCIsImNsaWVudFkiLCJjb250YWluZXJfdG9wIiwib2Zmc2V0UGFyZW50IiwiY29udGFpbmVyX3dpZHRoIiwicmVzaXplSW1hZ2UiLCJzdHlsZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJub2RlTmFtZSIsInRvTG93ZXJDYXNlIiwibW92aW5nIiwiZW5kTW92ZSIsIm1vdXNlWSIsIm1vdXNlWCIsImNyb3BfY2FudmFzIiwiaFJhdGlvIiwib3JpZ19oZWlnaHQiLCJjbGllbnRIZWlnaHQiLCJ3UmF0aW8iLCJvcmlnX3dpZHRoIiwiY2xpZW50V2lkdGgiLCJvdmVybGF5IiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50IiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsIndpbmRvdyIsIm9wZW4iLCJ0b0RhdGFVUkwiLCJvZmZzZXQiLCJnZXRPZmZzZXQiLCJvZmZzZXRXaWR0aCIsIm9mZnNldEhlaWdodCIsImVsZW1lbnQiLCJuZXdEaXYiLCJ3cmFwRGl2Iiwic3BhbiIsImFjdHVhbE9mZnNldExlZnQiLCJhY3R1YWxPZmZzZXRUb3AiLCJjdXJyZW50IiwiZ2V0TW91c2VQb3NpdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJJbWFnZSIsInJlc2l6ZV9jYW52YXMiLCJtYXhIZWlnaHQiXSwibWFwcGluZ3MiOiJBQVNBLFFBQVNBLFFBQ0xDLEtBQUtDLEtBQUtDLGFBQWFDLFdBQVcsa0NBQW1DRixLQUNoRUcsV0FBV0YsYUFBYUMsV0FBVyxrQ0FBbUNGLEtBQ3RFRyxXQUFXQyxZQUFZRixXQUFXLG1DQUNsQ0MsV0FBV0MsWUFBWUYsV0FBVyxtQ0FDdkNHLFNBQVNDLElBQU1OLElBQUlNLElBQ25CQyxVQUFZQyxTQUFTQyx1QkFBdUIsb0JBQW9CLEdBQ2hFRixVQUFVRyxpQkFBaUIsWUFBYUMsYUFDeENKLFVBQVVHLGlCQUFpQixZQUFhRSxXQUN4Q0MsU0FBU0gsaUJBQWlCLFFBQVNJLFNBR3ZDLFFBQVNILGFBQVlJLEdBQ2pCQSxFQUFFQyxpQkFDRkQsRUFBRUUsa0JBQ2lELElBQS9DRixFQUFFRyxPQUFPQyxVQUFVQyxRQUFRLG1CQUMzQkMsZUFBZU4sR0FDZlAsU0FBU0UsaUJBQWlCLFlBQWFZLFVBQ3ZDZCxTQUFTRSxpQkFBaUIsVUFBV2EsWUFJN0MsUUFBU0QsVUFBU1AsR0FDZCxHQUFJUyxHQUFPQyxFQUFRQyxFQUFNbkIsVUFBVW9CLFVBQVdDLEVBQU9yQixVQUFVc0IsV0FDM0RDLEVBQVVDLFlBQVlDLE1BQU1kLE9BQU9DLFNBQ1YsS0FBekJXLEVBQVFWLFFBQVEsT0FDaEJJLEVBQVFULEVBQUVrQixRQUFVRixZQUFZRyxlQUNoQ1QsRUFBU00sWUFBWUksa0JBQW9CcEIsRUFBRXFCLFFBQVVMLFlBQVlNLGVBQ2pFWCxFQUFNWCxFQUFFcUIsUUFBVTdCLFVBQVUrQixhQUFhWCxXQUNULElBQXpCRyxFQUFRVixRQUFRLE9BQ3ZCSSxFQUFRTyxZQUFZUSxpQkFBbUJ4QixFQUFFa0IsUUFBVUYsWUFBWUcsZ0JBQy9EVCxF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U0FBU0MsdUJBQXVCLG1CQUFtQixFQUlqRSxPQUhBNEQsR0FBT2xELFVBQVksbUJBQ25CbUQsRUFBUXJFLGFBQWFvRSxFQUFRRCxHQUM3QkMsRUFBT2pFLFlBQVlnRSxHQUNaQyxFQUdYLFFBQVNuRSxZQUFXNEIsR0FDaEIsR0FBSXlDLEdBQU8vRCxTQUFTa0QsY0FBYyxPQUVsQyxPQURBYSxHQUFLcEQsVUFBWVcsRUFDVnlDLEVBR1gsUUFBU04sV0FBVUcsR0FJZixJQUhBLEdBQUlJLEdBQW1CSixFQUFRdkMsV0FDM0I0QyxFQUFrQkwsRUFBUXpDLFVBQzFCK0MsRUFBVU4sRUFBUTlCLGFBQ0gsT0FBWm9DLEdBQ0hGLEdBQW9CRSxFQUFRN0MsV0FDNUI0QyxHQUFtQkMsRUFBUS9DLFVBQzNCK0MsRUFBVUEsRUFBUXBDLFlBRXRCLFFBQ0lWLEtBQU00QyxFQUNOOUMsSUFBSytDLEdBTWIsUUFBU0Usa0JBQWlCNUQsR0FDdEI2RCxRQUFRQyxJQUFJOUQsRUFBRWtCLFFBQVNsQixFQUFFcUIsU0F0SjdCLEdBQUkvQixVQUFXLEdBQUl5RSxPQUNmL0MsZUFDQXhCLFVBQ0FQLElBQU1RLFNBQVNpRCxlQUFlLE9BQzlCc0IsY0FBZ0J2RSxTQUFTa0QsY0FBYyxVQUN2QzdDLFNBQVdMLFNBQVNpRCxlQUFlLE9BQ25DTixZQUFjbkQsSUFBSW9ELGFBQ2xCRSxXQUFhdEQsSUFBSXVELFdBQ3JCdkQsS0FBSXlDLE1BQU11QyxVQUFZLFFBaUp0QnhFLFNBQVNFLGlCQUFpQixRQUFTaUUsa0JBQ25DZCxPQUFPbkQsaUJBQWlCLE9BQVFaIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvcmlnX3NyYyA9IG5ldyBJbWFnZSgpO1xyXG52YXIgZXZlbnRfc3RhdGUgPSB7fTtcclxudmFyIGNvbnRhaW5lcjtcclxudmFyIGltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWcnKTtcclxudmFyIHJlc2l6ZV9jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxudmFyIGNyb3BfYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bicpO1xyXG52YXIgb3JpZ19oZWlnaHQgPSBpbWcuY2xpZW50SGVpZ2h0LFxyXG4gICAgb3JpZ193aWR0aCA9IGltZy5jbGllbnRXaWR0aDtcclxuaW1nLnN0eWxlLm1heEhlaWdodCA9ICc0NTBweCc7XHJcbmZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICB3cmFwKGltZykuaW5zZXJ0QmVmb3JlKGNyZWF0ZVNwYW4oJ3Jlc2l6ZS1oYW5kbGUgcmVzaXplLWhhbmRsZS1udycpLCBpbWcpXHJcbiAgICAgICAgLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNyZWF0ZVNwYW4oJ3Jlc2l6ZS1oYW5kbGUgcmVzaXplLWhhbmRsZS1uZScpLCBpbWcpXHJcbiAgICAgICAgLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlU3BhbigncmVzaXplLWhhbmRsZSByZXNpemUtaGFuZGxlLXNlJykpXHJcbiAgICAgICAgLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlU3BhbigncmVzaXplLWhhbmRsZSByZXNpemUtaGFuZGxlLXN3JykpO1xyXG4gICAgb3JpZ19zcmMuc3JjID0gaW1nLnNyYztcclxuICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Jlc2l6ZS1jb250YWluZXInKVswXTtcclxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBzdGFydFJlc2l6ZSk7XHJcbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgc3RhcnRNb3ZlKTtcclxuICAgIGNyb3BfYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0YXJ0UmVzaXplKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoJ3Jlc2l6ZS1oYW5kbGUnKSAhPSAtMSkge1xyXG4gICAgICAgIHNhdmVFdmVudFN0YWdlKGUpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHJlc2l6aW5nKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZW5kUmVzaXplKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcmVzaXppbmcoZSkge1xyXG4gICAgdmFyIHdpZHRoLCBoZWlnaHQsIHRvcCA9IGNvbnRhaW5lci5vZmZzZXRUb3AsIGxlZnQgPSBjb250YWluZXIub2Zmc2V0TGVmdDtcclxuICAgIHZhciBjbHNOYW1lID0gZXZlbnRfc3RhdGUuZXZlbnQudGFyZ2V0LmNsYXNzTmFtZTtcclxuICAgIGlmIChjbHNOYW1lLmluZGV4T2YoJ25lJykgIT0gLTEpIHtcclxuICAgICAgICB3aWR0aCA9IGUuY2xpZW50WCAtIGV2ZW50X3N0YXRlLmNvbnRhaW5lcl9sZWZ0O1xyXG4gICAgICAgIGhlaWdodCA9IGV2ZW50X3N0YXRlLmNvbnRhaW5lcl9oZWlnaHQgLSAoZS5jbGllbnRZIC0gZXZlbnRfc3RhdGUuY29udGFpbmVyX3RvcCk7XHJcbiAgICAgICAgdG9wID0gZS5jbGllbnRZIC0gY29udGFpbmVyLm9mZnNldFBhcmVudC5vZmZzZXRUb3A7XHJcbiAgICB9IGVsc2UgaWYgKGNsc05hbWUuaW5kZXhPZignbncnKSAhPSAtMSkge1xyXG4gICAgICAgIHdpZHRoID0gZXZlbnRfc3RhdGUuY29udGFpbmVyX3dpZHRoIC0gKGUuY2xpZW50WCAtIGV2ZW50X3N0YXRlLmNvbnRhaW5lcl9sZWZ0KTtcclxuICAgICAgICBoZWlnaHQgPSBldmVudF9zdGF0ZS5jb250YWluZXJfaGVpZ2h0IC0gKGUuY2xpZW50WSAtIGV2ZW50X3N0YXRlLmNvbnRhaW5lcl90b3ApO1xyXG4gICAgICAgIHRvcCA9IGUuY2xpZW50WSAtIGNvbnRhaW5lci5vZmZzZXRQYXJlbnQub2Zmc2V0VG9wO1xyXG4gICAgICAgIGxlZnQgPSBlLmNsaWVudFggLSBjb250YWluZXIub2Zmc2V0UGFyZW50Lm9mZnNldExlZnQ7XHJcbiAgICB9IGVsc2UgaWYgKGNsc05hbWUuaW5kZXhPZignc2UnKSAhPSAtMSkge1xyXG4gICAgICAgIHdpZHRoID0gZS5jbGllbnRYIC0gZXZlbnRfc3RhdGUuY29udGFpbmVyX2xlZnQ7XHJcbiAgICAgICAgaGVpZ2h0ID0gZS5jbGllbnRZIC0gZXZlbnRfc3RhdGUuY29udGFpbmVyX3RvcDtcclxuICAgIH0gZWxzZSBpZiAoY2xzTmFtZS5pbmRleE9mKCdzdycpICE9IC0xKSB7XHJcbiAgICAgICAgd2lkdGggPSBldmVudF9zdGF0ZS5jb250YWluZXJfd2lkdGggLSAoZS5jbGllbnRYIC0gZXZlbnRfc3RhdGUuY29udGFpbmVyX2xlZnQpO1xyXG4gICAgICAgIGhlaWdodCA9IGUuY2xpZW50WSAtIGV2ZW50X3N0YXRlLmNvbnRhaW5lcl90b3A7XHJcbiAgICAgICAgbGVmdCA9IGUuY2xpZW50WCAtIGNvbnRhaW5lci5vZmZzZXRQYXJlbnQub2Zmc2V0TGVmdDtcclxuICAgIH1cclxuICAgIHJlc2l6ZUltYWdlKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICBjb250YWluZXIuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZXNpemVJbWFnZSh3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICBpbWcuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7XHJcbiAgICBpbWcuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JztcclxufVxyXG5cclxuZnVuY3Rpb24gZW5kUmVzaXplKGUpIHtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHJlc2l6aW5nLCBmYWxzZSk7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZW5kUmVzaXplLCBmYWxzZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0YXJ0TW92ZShlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2ltZycpIHtcclxuICAgICAgICBzYXZlRXZlbnRTdGFnZShlKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBtb3ZpbmcpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBlbmRNb3ZlKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gbW92aW5nKGUpIHtcclxuICAgIHZhciB0b3AgPSBldmVudF9zdGF0ZS5jb250YWluZXJfdG9wICsgZS5jbGllbnRZIC0gZXZlbnRfc3RhdGUubW91c2VZIC0gY29udGFpbmVyLm9mZnNldFBhcmVudC5vZmZzZXRUb3AsXHJcbiAgICAgICAgbGVmdCA9IGV2ZW50X3N0YXRlLmNvbnRhaW5lcl9sZWZ0ICsgZS5jbGllbnRYIC0gZXZlbnRfc3RhdGUubW91c2VYIC0gY29udGFpbmVyLm9mZnNldFBhcmVudC5vZmZzZXRMZWZ0O1xyXG4gICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICBjb250YWluZXIuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbmRNb3ZlKGUpIHtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG1vdmluZywgZmFsc2UpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGVuZE1vdmUsIGZhbHNlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29uZmlybShlKSB7XHJcbiAgICB2YXIgaFJhdGlvID0gb3JpZ19oZWlnaHQgLyBpbWcuY2xpZW50SGVpZ2h0LFxyXG4gICAgICAgIHdSYXRpbyA9IG9yaWdfd2lkdGggLyBpbWcuY2xpZW50V2lkdGg7XHJcbiAgICB2YXIgY3JvcF9jYW52YXMsIG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpO1xyXG4gICAgdmFyIGxlZnQgPSAob3ZlcmxheS5vZmZzZXRMZWZ0IC0gY29udGFpbmVyLm9mZnNldExlZnQpICogd1JhdGlvLFxyXG4gICAgICAgIHRvcCA9IChvdmVybGF5Lm9mZnNldFRvcCAtIGNvbnRhaW5lci5vZmZzZXRUb3ApICogaFJhdGlvLFxyXG4gICAgICAgIHdpZHRoID0gb3ZlcmxheS5jbGllbnRXaWR0aCAqIHdSYXRpbyxcclxuICAgICAgICBoZWlnaHQgPSBvdmVybGF5LmNsaWVudEhlaWdodCAqIGhSYXRpbztcclxuXHJcbiAgICBjcm9wX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgY3JvcF9jYW52YXMud2lkdGggPSB3aWR0aDtcclxuICAgIGNyb3BfY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuICAgIGNyb3BfY2FudmFzLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKGltZywgbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0LCAwLCAwLCB3aWR0aCAvIHdSYXRpbywgaGVpZ2h0IC8gaFJhdGlvKTtcclxuICAgIHdpbmRvdy5vcGVuKGNyb3BfY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJykpO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gc2F2ZUV2ZW50U3RhZ2UoZSkge1xyXG4gICAgdmFyIG9mZnNldCA9IGdldE9mZnNldChjb250YWluZXIpO1xyXG4gICAgZXZlbnRfc3RhdGUuY29udGFpbmVyX3dpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoO1xyXG4gICAgZXZlbnRfc3RhdGUuY29udGFpbmVyX2hlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7XHJcbiAgICBldmVudF9zdGF0ZS5jb250YWluZXJfbGVmdCA9IG9mZnNldC5sZWZ0O1xyXG4gICAgZXZlbnRfc3RhdGUuY29udGFpbmVyX3RvcCA9IG9mZnNldC50b3A7XHJcbiAgICBldmVudF9zdGF0ZS5tb3VzZVggPSBlLmNsaWVudFg7XHJcbiAgICBldmVudF9zdGF0ZS5tb3VzZVkgPSBlLmNsaWVudFk7XHJcbiAgICBldmVudF9zdGF0ZS5ldmVudCA9IGU7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiB3cmFwKGVsZW1lbnQpIHtcclxuICAgIHZhciBuZXdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHZhciB3cmFwRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2NyZWVuc2hvdC13cmFwJylbMF07XHJcbiAgICBuZXdEaXYuY2xhc3NOYW1lID0gJ3Jlc2l6ZS1jb250YWluZXInO1xyXG4gICAgd3JhcERpdi5pbnNlcnRCZWZvcmUobmV3RGl2LCBlbGVtZW50KTtcclxuICAgIG5ld0Rpdi5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuICAgIHJldHVybiBuZXdEaXY7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZVNwYW4oY2xzTmFtZSkge1xyXG4gICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICBzcGFuLmNsYXNzTmFtZSA9IGNsc05hbWU7XHJcbiAgICByZXR1cm4gc3BhbjtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0T2Zmc2V0KGVsZW1lbnQpIHtcclxuICAgIHZhciBhY3R1YWxPZmZzZXRMZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0LFxyXG4gICAgICAgIGFjdHVhbE9mZnNldFRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wLFxyXG4gICAgICAgIGN1cnJlbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudDtcclxuICAgIHdoaWxlIChjdXJyZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgYWN0dWFsT2Zmc2V0TGVmdCArPSBjdXJyZW50Lm9mZnNldExlZnQ7XHJcbiAgICAgICAgYWN0dWFsT2Zmc2V0VG9wICs9IGN1cnJlbnQub2Zmc2V0VG9wO1xyXG4gICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm9mZnNldFBhcmVudDtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbGVmdDogYWN0dWFsT2Zmc2V0TGVmdCxcclxuICAgICAgICB0b3A6IGFjdHVhbE9mZnNldFRvcCxcclxuICAgIH07XHJcbn1cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gZ2V0TW91c2VQb3NpdGlvbihlKSB7XHJcbiAgICBjb25zb2xlLmxvZyhlLmNsaWVudFgsIGUuY2xpZW50WSk7XHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZ2V0TW91c2VQb3NpdGlvbik7XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgaW5pdCk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
